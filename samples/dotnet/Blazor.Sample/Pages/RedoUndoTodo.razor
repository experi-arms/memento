@page "/todo"
@using Blazor.Sample.Stores
@inherits ObserverComponet
@inject RedoUndoTodoStore RedoUndoTodoStore

<h3>RedoUndoTodo</h3>

<div class="px-4 container">
    <div class="d-flex flex-column">
        @foreach (var todo in RedoUndoTodoStore.State.Todos) {
            <div class="d-flex">
                <input type="checkbox"
                   checked="@todo.IsCompleted"
                   onchange="@(() => HandleCheckChanged(todo.TodoId))" />
                <div>@todo.IsCompleted @todo.Text</div>
            </div>
        }
    </div>

    <div class="d-flex">
        <input @bind="text" />
        <button class="btn btn-primary" @onclick="@AddTodo">ADD</button>
    </div>

    <div class="d-flex mt-3">
        <button class="mt-3 btn btn-primary" disabled="@(!RedoUndoTodoStore.CanUnDo)" @onclick="Undo">Undo</button>
        <button class="mt-3 btn btn-primary" disabled="@(!RedoUndoTodoStore.CanReDo)" @onclick="Redo">Redo</button>
    </div>
</div>

@code {
    string text = "";

    async Task AddTodo() {
        var _text = text;
        text = "";

        await RedoUndoTodoStore.CreateNewAsync(_text);
    }

    async Task Redo() {
        await this.RedoUndoTodoStore.ReExecuteAsync();
    }

    async Task Undo() {
        await this.RedoUndoTodoStore.UnExecuteAsync();
    }

    async Task HandleCheckChanged(Guid id) {
        await this.RedoUndoTodoStore.ToggleIsCompletedAsync(id);
    }
}
